# L4와 L7의 차이 (로드밸런서)

- 22.12.27 

## 로드 밸런서란?

서버가  단  하나만  존재할  때  수천만명의  사람들이  서버에  동시  접속하면  어떻게  될까?

하나의  서버는  부하를  감당하지  못할  수도  있을  것이다. 이를  해결하는  방식에는  장비를  업그레이드하는  **Scale-up**방식과  장비를  여러개  두는  **Scale-out**방식이  있다.

### 로드밸런서 없이 서버를 SCALE-UP 했을때 발생하는 문제!

**Scale-out** 방식으로 여러 서버를 둔다면 해당 서비스에 접근하기 위해서는 서버마다 다른 IP가 필요하다. 서버마다 다른 공인 IP를 부여한다면 사용자들마다 각각 다른 IP로 접속할 것이고, 운영자가 원하는대로 딱! 떨어지게 부하를 분산하기 어렵다.  1000명의 사용자가 있을때 서버 2대에 500명 : 500명 접속하지 않고, 999명은 A서버에, 1명은 B서버에 접속한다면, 고가의 비용을 들여 새로운 서버를 증설한것이 헛수고가 되어버린다.

이런 상황을 방지하기 위해 서버에 가해지는 트래픽의 부하를 분산하는 작업이 필요한데, 이렇게 두개이상의 컴퓨터자원에 작업을 나누는것을 로드밸런싱이라고 하고, 이런 작업을 하는 장비를 로드밸런서라고 한다.

### 로드 밸런서의 주요 기능

1. Network Address Translation(NAT)

사설 IP를 공인 IP로

2. Tunneling

데이터를 캡슐화하여 연결되어진 노드만 그 데이터의 캡슐을 풀어서 볼 수 있게 함.

3. Dynamic Source Routing protocol(DSR)

요청에 대한 응답을 할 때 로드밸런서가 아닌 클라이언트의 IP로 응답

## 로드밸런서의 종류

OSI 7계층을 기준으로 종류가 나뉜다. 상위  계층으로  갈수록  섬세한  부하  분산이  가능하지만  가격이  비싸진다.

- L2	- Data link 계층을 사용, Mac주소 기반 부하 분산
- L3	- Network 계층을 사용, IP주소 기반 부하 분산
- L4	- Transport 계층을 사용, `Port` 기반 부하 분산
- L7	- Application 계층을 사용, `요청(URL)` 기반 부하 분산

![](https://i.imgur.com/0ItDLD6.png)
![](https://i.imgur.com/hCeSWWD.png)

### 마이크로 서비스 관점에서의 L4와 L7의 차이
url을 읽어오는 L7은 `/order` 만으로 or
<!--stackedit_data:
eyJoaXN0b3J5IjpbNzE4OTU5ODUxLDIwNTY3OTkzODhdfQ==
-->